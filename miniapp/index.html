<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>miniapp | yuicer</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="https://img.yuicer.com/me.config/me.png">
    <meta name="description" content="colorful wanted">
    
    <link rel="preload" href="/assets/css/0.styles.9d116826.css" as="style"><link rel="preload" href="/assets/js/app.0958dc5d.js" as="script"><link rel="preload" href="/assets/js/4.5b843dec.js" as="script"><link rel="preload" href="/assets/js/5.4f7e8107.js" as="script"><link rel="preload" href="/assets/js/31.4201373b.js" as="script"><link rel="prefetch" href="/assets/js/1.84fdeac6.js"><link rel="prefetch" href="/assets/js/10.f47326a2.js"><link rel="prefetch" href="/assets/js/11.015673ec.js"><link rel="prefetch" href="/assets/js/12.35cf854d.js"><link rel="prefetch" href="/assets/js/13.0cb0bd13.js"><link rel="prefetch" href="/assets/js/14.2a2cd11b.js"><link rel="prefetch" href="/assets/js/15.3932639a.js"><link rel="prefetch" href="/assets/js/16.a950256a.js"><link rel="prefetch" href="/assets/js/17.f38da1f2.js"><link rel="prefetch" href="/assets/js/18.82e81f40.js"><link rel="prefetch" href="/assets/js/19.467d18e1.js"><link rel="prefetch" href="/assets/js/20.ea1eeb89.js"><link rel="prefetch" href="/assets/js/21.dce4b66a.js"><link rel="prefetch" href="/assets/js/22.a4cb4010.js"><link rel="prefetch" href="/assets/js/23.4e23238e.js"><link rel="prefetch" href="/assets/js/24.ca52664f.js"><link rel="prefetch" href="/assets/js/25.cd0186b7.js"><link rel="prefetch" href="/assets/js/26.8631edec.js"><link rel="prefetch" href="/assets/js/27.d00edefa.js"><link rel="prefetch" href="/assets/js/28.ebb5853f.js"><link rel="prefetch" href="/assets/js/29.27a4411f.js"><link rel="prefetch" href="/assets/js/30.65f837b1.js"><link rel="prefetch" href="/assets/js/32.e2683603.js"><link rel="prefetch" href="/assets/js/33.d951fe77.js"><link rel="prefetch" href="/assets/js/34.d3f94057.js"><link rel="prefetch" href="/assets/js/35.1ddffe8a.js"><link rel="prefetch" href="/assets/js/36.52bddbdc.js"><link rel="prefetch" href="/assets/js/37.22db3779.js"><link rel="prefetch" href="/assets/js/38.214de49f.js"><link rel="prefetch" href="/assets/js/39.a83709cc.js"><link rel="prefetch" href="/assets/js/6.ef9b23be.js"><link rel="prefetch" href="/assets/js/7.4eede40e.js"><link rel="prefetch" href="/assets/js/8.b9542584.js"><link rel="prefetch" href="/assets/js/9.15f840d6.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.5f196bb7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9d116826.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" style="background-image:url(https://img.yuicer.com//bg/winter.jpg),linear-gradient(#ccc 0%,#ccc 100%);background-attachment:fixed;background-position-x:50%;background-position-y:0%;background-blend-mode:multiply;background-repeat:no-repeat;background-size:cover;" data-v-7024d1ce data-v-ec218eb8><header class="navbar" data-v-7024d1ce><div class="sidebar"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true" class="icon"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg> <div class="pan"><div class="link-item"><a href="https://github.com/yuicer" target="_blank">github</a></div><div class="link-item"><a href="https://space.bilibili.com/3069623" target="_blank">B 站</a></div></div></div> <a href="/" class="home-link router-link-active"><div alt="yuicer" class="logo" style="background-image:url(https://img.yuicer.com/me.config/me.png);"></div> <span class="site-name can-hide">yuicer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="wrapper" data-v-7024d1ce><main class="page" data-v-7024d1ce data-v-ec218eb8> <div class="page-title" data-v-7024d1ce data-v-ec218eb8>miniapp</div> <div class="tags" data-v-7024d1ce data-v-ec218eb8><div data-v-7024d1ce data-v-ec218eb8><span data-v-7024d1ce data-v-ec218eb8>砖头</span></div> <div class="time" data-v-7024d1ce data-v-ec218eb8><span data-v-7024d1ce data-v-ec218eb8>Apr 19  2023</span></div></div> <!----> <div class="theme-yuicer-content content__default" data-v-ec218eb8><h2 id="小程序语法"><a href="#小程序语法" class="header-anchor">#</a> 小程序语法</h2> <p>(ttml + js + ttss)</p> <p>小程序作为一个有特殊业务属性的产物，对安全稳定体验有比较高的要求，所以它的方向是 webview + hybrid。具有 web 灵活开发，同时也能使用很多 app 提供的能力</p> <p>因为安全的原由，小程序的开发和传统的 web 区别较大。最集中体现在对环境的操作，如 dom eval 这类。</p> <p>小程序有一套 vue-like 的语法。如此选择一是因为它需要用模版来做一些控制隔离，而是做一些编译上的处理和优化。所以它摈弃了 react jsx 这种非常灵活的函数写法。而是结合 vue 和 svelte 的优点来做架构，他的 diff 也是结合这两个来做，不完全用 svelte 是因为想保持小体积。</p> <h2 id="小程序架构"><a href="#小程序架构" class="header-anchor">#</a> 小程序架构</h2> <p>双线程。做到 js （v8,qjs,jsc）逻辑和实际 ui 渲染的分离，本质在于这是一个 app 上的 webview
基于 app， 多 webview，web 标准</p> <h2 id="小程序-js-选型"><a href="#小程序-js-选型" class="header-anchor">#</a> 小程序 js 选型</h2> <p>这一块有很多选择</p> <p>JavasScriptCore 是 ios 阵营，safari，wkwebview 自带。但是对安卓适配和性能差一些</p> <p>V8 安卓阵营，性能很强，但是内存体积占用很高</p> <p>Hermes facebook 为 react native 打造，体积小，内存小，适合重 ui 场景， hybrid 模式。（生成字节码。和端，多语言配合好）</p> <p>QuickJs 内存体积很小，性能还可以。嵌入式开发友好</p> <p>一般来说，ios 都会选择 jsc，安卓使用 qjs 的比较多</p> <h2 id="jsbridge"><a href="#jsbridge" class="header-anchor">#</a> jsBridge</h2> <p>它更像是一个概念，有非常多种的实现。</p> <p>比如可以直接粗暴的给 webview context 全局环境注入方法，使 js 可以直接用</p> <p>也可以通过 uri scheme</p> <p>这一块本质上来说，是构造了一个中间层 jssdk，将 app 的方法注入</p> <h2 id="canvas-v2-v1"><a href="#canvas-v2-v1" class="header-anchor">#</a> canvas v2 v1</h2> <p>https://developers.weixin.qq.com/miniprogram/dev/framework/ability/canvas-legacy-migration.html</p> <p>canvas v2 v1 的本质区别应该在于 canvas 这个组件从 webview 实现变成了端实现（同层渲染）</p> <p>所以通信从 jscore =&gt; webview 变成了 jscore =&gt; end api</p> <p>同时 js 通信从双线程变成了直接可以调端上同步方法，一些 canvas api 也转成了同步方法，也不再需要 draw 方法</p> <h3 id="同层渲染"><a href="#同层渲染" class="header-anchor">#</a> 同层渲染</h3> <p>解决一些高级功能不好用不可用，同步位置信息耗时，css 支持不好，zindex 不起作用，这类控件难受 webview 控制</p> <p>最开始都是 cover 覆盖的方式叠层 webview，下面的 webview 对应的部分做透明，然后同步位置信息</p> <p>ios =》WKWebview 启用 UIScrollVIew</p> <ol><li>background-color</li> <li>className</li></ol> <p>android 挖洞/三明治，本质多层
1 找一块内容变透明下面放 background-webview native-view display-webview</p> <p>真正同层</p> <ol><li>embed html</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. &lt;embed style=&quot;width: 300px; height:200px;&quot; type=&quot;plugon/text_box&quot;&gt; &lt;/embed&gt;
2. plugin receive =&gt; webview extension surfacetexture 绘制上屏
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="小程序测试"><a href="#小程序测试" class="header-anchor">#</a> 小程序测试</h2> <p>采用 shoots 服务
https://github.com/Tencent/QTAF
https://appium.io/docs/en/2.0/
https://github.com/AirtestProject/Airtest</p> <p>Accessibility</p> <h2 id="其他参考"><a href="#其他参考" class="header-anchor">#</a> 其他参考</h2> <h3 id="react"><a href="#react" class="header-anchor">#</a> react</h3> <p>react 由于灵活的特性无法做预编译去进行标记，所以其 vdom 更新 只能从 root 开始重新生成,在大应用程序的场景下会非常卡。于是进行了时间分片的优化，设计了新的 fiber 和 schedule 来帮助做这件事情。实现了自己的 <code>requestIdleCallback</code>，同时也做了批量跟新来减少 update，其策略主要在运行时</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>render(){
  return  &lt;h1 class=&quot;greeting&quot;&gt;hello&lt;/h1&gt;
  return  react.createElement(
    'h1',
    { className: 'greeting' },
    'Hello'
  );  
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>react is transformed from reactive to schedule</p> <ol><li>批量更新</li> <li>并发</li> <li>任务优先级(fetch data vs click)</li></ol> <h3 id="vue"><a href="#vue" class="header-anchor">#</a> vue</h3> <p>vue 由于其有模版 html，所以比较易做预编译处理优化。</p> <p>1.打平树结构
2. 提取静态标签
3. 区分不同功能 <code>v-if v-for </code>的标签进行不同处理</p> <h3 id="svelte"><a href="#svelte" class="header-anchor">#</a> svelte</h3> <p>svelte 则是不适用运行时，在编译时进行绑定</p> <h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <p>https://cloud.tencent.com/developer/article/1801742
https://github.com/berwin/Blog/issues/49</p></div> <div class="page-nav" data-v-7024d1ce data-v-ec218eb8><p class="inner" data-v-7024d1ce data-v-ec218eb8><span class="prev" data-v-7024d1ce data-v-ec218eb8><a href="/morphing/" class="prev" data-v-ec218eb8><span data-v-ec218eb8>←</span>
            morphing animation
          </a></span> <span class="next" data-v-7024d1ce data-v-ec218eb8><a href="/daily-tip4/" class="next" data-v-ec218eb8>
            Daily tip 04
            <span data-v-ec218eb8>→</span></a></span></p></div> <!----> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0958dc5d.js" defer></script><script src="/assets/js/4.5b843dec.js" defer></script><script src="/assets/js/5.4f7e8107.js" defer></script><script src="/assets/js/31.4201373b.js" defer></script>
  </body>
</html>
